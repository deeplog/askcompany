# 장고 인증

[ReadMe로 돌아가기](../ReadMe.md)

목차  
------

[1. 로그인 처리](#1.-로그인-처리)

[2.사용자 프로필 페이지 및 수정](#2.-사용자-프로필-페이지-및-수정)



## 1. 로그인 처리

기본적으로 accounts에서 처리한다. 

accounts/urls.py

```python
urlpatterns = [
    path(
        "login/",
        LoginView.as_view(template_name="accounts/login_form.html"),
        name="login",
    ),
]
```

accounts/templates/accounts/login_form.html

```html
{% extends "accounts/layout.html" %}
{% load bootstrap4 %}

{% block content %}
    <form action="" method="post">
        {% csrf_token %}
        {% bootstrap_form form %}
        {% buttons %}
            <button class="btn btn-primary">로그인</button>
        {% endbuttons %}
    </form>
{% endblock content %}
```



## 2. 사용자 프로필 페이지 및 수정

### 프로필 만들기

accounts/urls.py

```python
urlpatterns = [
    path("profile/", views.profile, name="profile"),
    path("profile/edit/", views.profile_edit, name="profile_edit"),
]
```

accounts/views.py

```python
class ProfileView(LoginRequiredMixin, TemplateView):
    template_name = "accounts/profile.html"

profile = ProfileView.as_view()
```

accounts/templates/accounts/profile.html

```html
{% extends 'accounts/layout.html' %}

{% block content %}
    user:
        - 로그인: User 모델 인스턴스
        - 로그아웃: AnonymousUser (파이썬 클래스) 인스턴스
    {#콘텍스트 목록에 있는 사전 #}
    <h2> User: {{ user }}</h2>
    {{ user.is_autenticated }}

    {% if user.profile %}
        <ul>
            <li>{{ user.profile.user }}</li>
            <li>{{ user.profile.zipcode }}</li>
            <li>{{ user.profile.address }}</li>
        </ul>
    {% endif %}
    <a href="{% url "profile_edit" %}" class="btn btn-primary">
        프로필 수정
    </a>
{% endblock %}
```



### 프로필 수정 만들기

accounts/forms.py

```python
from django import forms
from .models import Profile

class ProfileForm(forms.ModelForm):
    class Meta:
        model = Profile
        fields = ["address", "zipcode"]
```

accounts/views.py

```python
@login_required
def profile_edit(request):
    try:
        profile = (
            request.user.profile  # = Profile.objects.get(user = request.user.profile)
        )  
    except Profile.DoesNotExist:
        profile = None

    if request.method == "POST":
        form = ProfileForm(request.POST, request.FILES, instance=profile)
        if form.is_valid():
            profile = form.save(commit=False)
            profile.user = request.user
            profile.save()
            return redirect("profile")
    else:
        form = ProfileForm(instance=profile)
    return render(
        request,
        "accounts/profile_form.html",
        {
            "form": form,
        },
    )
```

accounts/templates/accounts/profile_edit.html

```html
{% extends "accounts/layout.html" %}
{% load bootstrap4 %}

{% block content %}
    <form action="" method="post">
        {% csrf_token %}
        {% bootstrap_form form %}
        {% buttons %}
            <button class="btn btn-primary">프로필 수정</button>
        {% endbuttons %}
    </form>
{% endblock content %}
```

[목차로 이동](#목차)   

