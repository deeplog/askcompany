목차   
------
[1. 함수 기반 뷰](#함수-기반-뷰)   
[2. HttpResponse 활용](#HttpResponse)   

함수 기반 뷰
---
### view

view는 1개의  http의 요청에 대해 1개의 뷰가 호출됨   
뷰는 urlpatterns 리스트에 매핑된 함수 (또는 호출 가능한 객체) 이다.
두가지 형태의 뷰
* 함수기반 뷰 (Function Based View)
* 클래스 기반 뷰 (Class Based View)

### view 인자
1번째 인자: HttpRequest 객체   
2번재 인자: URL Captured Values

```python
# urls.py
urlpatterns = [
    path('', views.post_list),
    path('<int:pk>/', views.post_detail)
]
# views.py
def post_detail(request, pk):
    pass
```

## view 리턴값

[HttpResponse 객체 리턴](https://docs.djangoproject.com/en/4.1/ref/request-response/#django.http.HttpResponse)   
다른 타입을 리턴하면 Middleware에서 오류 처리함


``` python
# view에서 None을 리터하는 경우
def post_detail(request, pk):
    pass

# error 메세지
htmlValueError at /instagram/1/
The view instagram.views.post_detail didn't return an HttpResponse object. It returned None instead.
Request Method:	GET
Request URL:	http://127.0.0.1:8000/instagram/1/
Django Version:	3.2.15
Exception Type:	ValueError
Exception Value:	
The view instagram.views.post_detail didn't return an HttpResponse object. It returned None instead.
```

### HTTPRequest와 Http Response 예시

```python
def post_list(reqeust):
    qs = Post.objects.all()
    q = reqeust.GET.get('q','') # q key가 있으면 가져오고, 없으면 ''
    if q:
        qs = qs.filter(message__icontains=q) # 필터링 기능 구현이 됨
        #instagram/templates/instagram/post_list.html
    return render(reqeust, 'instagram/post_list.html', {
        'post_list':qs,
        'q':q,
        })
```

[장고 관련 문서](https://docs.djangoproject.com/en/4.1/ref/request-response/)

HttpResponse
----------------

### Excel 파일 다운로드 하기 
```python
from django.http import HttpResponse
from urllib.parse import quote
import os

def response_excel(request):
    filepath = '/other/path/excel.xls'
    filename = os.path.join(filepath)

    with open(filepath, 'rb') as f:
        response = HttpResponse(f, content_type='application/vnd.ms-excel')

        # 브라우저에 따라 다른 처리 필요
        # 장고의 FileResponse를 이용하면 더 수월하게 할 수 있다. 
        encoded_filename = quote(filename)
        response['Content-Disposition'] = "attachment; filename*=utf-8''{}".format(encoded_filename)

    return response
```

### Pandas 데이터 다운로드 하기
```python
import pandas as pd
from django.http import HttpResponse

def response_csv(request):
    df = pd.DataFrame([
        [100, 110, 120],
        [200, 210, 220],
        [300, 310, 320],
    ])

    response = HttpResponse(
        content_type='text/csv',
        headers={'Content-Disposition': 'attachment; filename="test.csv'},
    )
    df.to_csv(path_or_buf = response)
    return response
```
